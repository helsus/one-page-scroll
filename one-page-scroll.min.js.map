{"version":3,"file":"one-page-scroll.min.js.map","sources":["src/index.js"],"sourcesContent":["/* global Blob URL CustomEvent location history */\n\n/**\n * a simpleThrottling function\n *\n * @param {(...args) => any} callback\n * @param {number} time\n * @returns {(n: number) => onePageScroll}\n */\nconst simpleThrottling = (callback, time) => {\n  let calledTime = 0\n  return n => {\n    const now = Date.now()\n    if (calledTime + time < now) {\n      calledTime = now\n      callback(n)\n    }\n  }\n}\n\nlet init = () => {\n  const style = `\n    body{\n      overflow: hidden\n    }\n    .one-page-scroll--page{\n      width: 100%;\n      height: 100%;\n      overflow: hidden;\n      touch-action: none;\n      position: absolute\n    }\n  `\n  const css = new Blob([style], { type: 'text/css' })\n  const link = document.createElement('link')\n  link.setAttribute('rel', 'stylesheet')\n  link.setAttribute('href', URL.createObjectURL(css))\n  document.head.appendChild(link)\n  init = () => {}\n}\n\nclass onePageScroll {\n  /**\n   * constructor\n   *\n   * @typedef {Object} onePageScrollOption\n   * @property {NodeListOf<HTMLElement> | HTMLElement[]} el - input Element\n   * @property {number} [time=600] - animation time\n   * @property {string} [easing='ease-out'] - animation easing\n   * @property {boolean} [loop=false] - goto first page after the last page\n   * @property {number} [throttling=600]\n   * @param {onePageScrollOption}\n   * @constructor\n   */\n  constructor ({\n    el,\n    time = 600,\n    easing = 'ease-out',\n    loop = false,\n    throttling\n  } = {}) {\n    init()\n    if (!el || !el.length) {\n      throw new Error('el is undefined')\n    }\n\n    /*\n     * Variable Initialization\n     */\n    this.time = time\n    this.easing = easing\n    this.loop = loop\n    this.pageTotal = el.length\n    /** @type {number} */\n    this.active = 1\n    throttling = throttling || time\n    /** @type {HTMLElement[]} */\n    this._el = [].slice.call(el)\n    this._el.forEach((el, index) => {\n      el.classList.add('one-page-scroll--page')\n      el.style.transform = `translateY(${index * 100}%)`\n    })\n    this._hash = this._el.map((el, i) => el.getAttribute('name') || i + 1)\n\n    /*\n     * Url Hash Initialization\n     */\n    const findHash = () => location.hash === '' ? 1 : this._hash.findIndex((hash, i) => {\n      if (['#' + hash, '#' + (i + 1)].includes(location.hash)) {\n        return true\n      }\n    }) + 1\n    this.goto(findHash())\n\n    /*\n     * define throttling function\n     * for Event handle using\n     */\n    const wrapGoto = n => this.goto(n)\n    this._goto = throttling ? simpleThrottling(wrapGoto, throttling) : wrapGoto\n\n    /*\n     * Event register\n     */\n    window.addEventListener('popstate', e => {\n      const hashIndex = findHash()\n      if (hashIndex) {\n        this.goto(hashIndex, true)\n      }\n    });\n    ['keydown', 'mousewheel', 'DOMMouseScroll', 'touchstart'].map(e =>\n      document.addEventListener(e, this)\n    )\n  }\n\n  /**\n   * goto the nth page\n   *\n   * @param {number} n - the page number you want to go\n   * @return {onePageScroll}\n   */\n  goto (n) {\n    if (n > this.pageTotal || n < 1) {\n      this.loop ? (n = 1) : (n = this.active)\n    }\n    if (n !== this.active) {\n      this._el.forEach((el, index) => {\n        const style = el.style\n        style.transition = `transform ${this.time}ms ${this.easing}`\n        style.transform = `translateY(${(index - n + 1) * 100}%)`\n      })\n      this._el[this.active - 1].dispatchEvent(new CustomEvent('outview'))\n      this._el[n - 1].dispatchEvent(new CustomEvent('inview'))\n      this.active = n\n      !arguments[1] && history.replaceState({}, '', '#' + this._hash[n - 1])\n    }\n    return this\n  }\n\n  /**\n   * goto the next page\n   *\n   * @return {onePageScroll}\n   */\n  next () {\n    return this.goto(this.active + 1)\n  }\n\n  /**\n   * goto the prev page\n   *\n   * @return {onePageScroll}\n   */\n  prev () {\n    return this.goto(this.active - 1)\n  }\n\n  /**\n   * Event handler\n   *\n   * @param {Event} e\n   * @private\n   */\n\n  handleEvent (e) {\n    /** @type {(e: KeyboardEvent) => void} */\n    const handleKeyDown = e => {\n      switch (e.keyCode) {\n        // PgUp, ↑\n        case 33:\n        case 38:\n          this._goto(this.active - 1)\n          break\n        // PgDn, ↓, Space\n        case 32:\n        case 34:\n        case 40:\n          this._goto(this.active + 1)\n          break\n        // Home\n        case 36:\n          this._goto(1)\n          break\n        // End\n        case 35:\n          this._goto(this.pageTotal)\n          break\n      }\n    }\n\n    /** @type {(e: WheelEvent) => void} */\n    const handleMouseWheel = e => {\n      const delta = Math.max(-1, Math.min(1, e.wheelDelta || -e.detail))\n      if (delta < 0) {\n        this._goto(this.active + 1)\n      } else {\n        this._goto(this.active - 1)\n      }\n    }\n\n    /** @type {(e: TouchEvent) => void} */\n    const handleTouchStart = e => {\n      const touches = e.touches\n      if (touches && touches.length) {\n        this._touchStartY = touches[0].pageY\n        document.addEventListener('touchmove', this)\n      }\n    }\n\n    /** @type {(e: TouchEvent) => void} */\n    const handleTouchMove = e => {\n      const touches = e.touches\n      if (touches && touches.length) {\n        e.preventDefault()\n        const deltaY = this._touchStartY - touches[0].pageY\n        if (deltaY >= 50) {\n          this._goto(this.active + 1)\n        }\n        if (deltaY <= -50) {\n          this._goto(this.active - 1)\n        }\n        if (Math.abs(deltaY) >= 50) {\n          document.removeEventListener('touchmove', this)\n        }\n      }\n    }\n\n    switch (e.type) {\n      case 'keydown':\n        handleKeyDown(e)\n        break\n      case 'mousewheel':\n      case 'DOMMouseScroll':\n        handleMouseWheel(e)\n        break\n      case 'touchstart':\n        handleTouchStart(e)\n        break\n      case 'touchmove':\n        handleTouchMove(e)\n    }\n  }\n}\n\nmodule.exports = onePageScroll\nmodule.exports.default = onePageScroll\n"],"names":["init","css","Blob","type","link","document","createElement","setAttribute","URL","createObjectURL","head","appendChild","onePageScroll","el","time","easing","loop","throttling","length","Error","pageTotal","active","_el","slice","call","forEach","index","classList","add","style","transform","_hash","this","map","i","getAttribute","findHash","location","hash","_this","findIndex","includes","goto","callback","calledTime","wrapGoto","n","_goto","now","Date","window","addEventListener","e","hashIndex","transition","_this2","dispatchEvent","CustomEvent","arguments","history","replaceState","touches","keyCode","_this3","handleKeyDown","Math","max","min","wheelDelta","detail","_touchStartY","pageY","preventDefault","deltaY","abs","removeEventListener","handleTouchMove","module","exports","default"],"mappings":"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"}