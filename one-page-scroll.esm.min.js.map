{"version":3,"file":"one-page-scroll.esm.min.js.map","sources":["src/index.js"],"sourcesContent":["/* global Blob URL CustomEvent location history */\n\n/**\n * a simpleThrottling function\n *\n * @param {(...args) => any} callback\n * @param {number} time\n * @returns {(n: number) => onePageScroll}\n */\nconst simpleThrottling = (callback, time) => {\n  let calledTime = 0\n  return n => {\n    const now = Date.now()\n    if (calledTime + time < now) {\n      calledTime = now\n      callback(n)\n    }\n  }\n}\n\nlet init = () => {\n  const style = `\n    body{\n      overflow: hidden\n    }\n    .one-page-scroll--page{\n      width: 100%;\n      height: 100%;\n      overflow: hidden;\n      touch-action: none;\n      position: absolute\n    }\n  `\n  const css = new Blob([style], { type: 'text/css' })\n  const link = document.createElement('link')\n  link.setAttribute('rel', 'stylesheet')\n  link.setAttribute('href', URL.createObjectURL(css))\n  document.head.appendChild(link)\n  init = () => {}\n}\n\nclass onePageScroll {\n  /**\n   * constructor\n   *\n   * @typedef {Object} onePageScrollOption\n   * @property {NodeListOf<HTMLElement> | HTMLElement[]} el - input Element\n   * @property {number} [time=600] - animation time\n   * @property {string} [easing='ease-out'] - animation easing\n   * @property {boolean} [loop=false] - goto first page after the last page\n   * @property {number} [throttling=600]\n   * @param {onePageScrollOption}\n   * @constructor\n   */\n  constructor ({\n    el,\n    time = 600,\n    easing = 'ease-out',\n    loop = false,\n    throttling\n  } = {}) {\n    init()\n    if (!el || !el.length) {\n      throw new Error('el is undefined')\n    }\n\n    /*\n     * Variable Initialization\n     */\n    this.time = time\n    this.easing = easing\n    this.loop = loop\n    this.pageTotal = el.length\n    /** @type {number} */\n    this.active = 1\n    throttling = throttling || time\n    /** @type {HTMLElement[]} */\n    this._el = [].slice.call(el)\n    this._el.forEach((el, index) => {\n      el.classList.add('one-page-scroll--page')\n      el.style.transform = `translateY(${index * 100}%)`\n    })\n    this._hash = this._el.map((el, i) => el.getAttribute('name') || i + 1)\n\n    /*\n     * Url Hash Initialization\n     */\n    const findHash = () => location.hash === '' ? 1 : this._hash.findIndex((hash, i) => {\n      if (['#' + hash, '#' + (i + 1)].includes(location.hash)) {\n        return true\n      }\n    }) + 1\n    this.goto(findHash())\n\n    /*\n     * define throttling function\n     * for Event handle using\n     */\n    const wrapGoto = n => this.goto(n)\n    this._goto = throttling ? simpleThrottling(wrapGoto, throttling) : wrapGoto\n\n    /*\n     * Event register\n     */\n    window.addEventListener('popstate', e => {\n      const hashIndex = findHash()\n      if (hashIndex) {\n        this.goto(hashIndex, true)\n      }\n    });\n    ['keydown', 'mousewheel', 'DOMMouseScroll', 'touchstart'].map(e =>\n      document.addEventListener(e, this)\n    )\n  }\n\n  /**\n   * goto the nth page\n   *\n   * @param {number} n - the page number you want to go\n   * @return {onePageScroll}\n   */\n  goto (n) {\n    if (n > this.pageTotal || n < 1) {\n      this.loop ? (n = 1) : (n = this.active)\n    }\n    if (n !== this.active) {\n      this._el.forEach((el, index) => {\n        const style = el.style\n        style.transition = `transform ${this.time}ms ${this.easing}`\n        style.transform = `translateY(${(index - n + 1) * 100}%)`\n      })\n      this._el[this.active - 1].dispatchEvent(new CustomEvent('outview'))\n      this._el[n - 1].dispatchEvent(new CustomEvent('inview'))\n      this.active = n\n      !arguments[1] && history.replaceState({}, '', '#' + this._hash[n - 1])\n    }\n    return this\n  }\n\n  /**\n   * goto the next page\n   *\n   * @return {onePageScroll}\n   */\n  next () {\n    return this.goto(this.active + 1)\n  }\n\n  /**\n   * goto the prev page\n   *\n   * @return {onePageScroll}\n   */\n  prev () {\n    return this.goto(this.active - 1)\n  }\n\n  /**\n   * Event handler\n   *\n   * @param {Event} e\n   * @private\n   */\n\n  handleEvent (e) {\n    /** @type {(e: KeyboardEvent) => void} */\n    const handleKeyDown = e => {\n      switch (e.keyCode) {\n        // PgUp, ↑\n        case 33:\n        case 38:\n          this._goto(this.active - 1)\n          break\n        // PgDn, ↓, Space\n        case 32:\n        case 34:\n        case 40:\n          this._goto(this.active + 1)\n          break\n        // Home\n        case 36:\n          this._goto(1)\n          break\n        // End\n        case 35:\n          this._goto(this.pageTotal)\n          break\n      }\n    }\n\n    /** @type {(e: WheelEvent) => void} */\n    const handleMouseWheel = e => {\n      const delta = Math.max(-1, Math.min(1, e.wheelDelta || -e.detail))\n      if (delta < 0) {\n        this._goto(this.active + 1)\n      } else {\n        this._goto(this.active - 1)\n      }\n    }\n\n    /** @type {(e: TouchEvent) => void} */\n    const handleTouchStart = e => {\n      const touches = e.touches\n      if (touches && touches.length) {\n        this._touchStartY = touches[0].pageY\n        document.addEventListener('touchmove', this)\n      }\n    }\n\n    /** @type {(e: TouchEvent) => void} */\n    const handleTouchMove = e => {\n      const touches = e.touches\n      if (touches && touches.length) {\n        e.preventDefault()\n        const deltaY = this._touchStartY - touches[0].pageY\n        if (deltaY >= 50) {\n          this._goto(this.active + 1)\n        }\n        if (deltaY <= -50) {\n          this._goto(this.active - 1)\n        }\n        if (Math.abs(deltaY) >= 50) {\n          document.removeEventListener('touchmove', this)\n        }\n      }\n    }\n\n    switch (e.type) {\n      case 'keydown':\n        handleKeyDown(e)\n        break\n      case 'mousewheel':\n      case 'DOMMouseScroll':\n        handleMouseWheel(e)\n        break\n      case 'touchstart':\n        handleTouchStart(e)\n        break\n      case 'touchmove':\n        handleTouchMove(e)\n    }\n  }\n}\n\nexport default onePageScroll\n"],"names":["simpleThrottling","callback","time","calledTime","n","now","Date","init","css","Blob","type","link","document","createElement","setAttribute","URL","createObjectURL","head","appendChild","onePageScroll","[object Object]","el","easing","loop","throttling","length","Error","this","pageTotal","active","_el","slice","call","forEach","index","classList","add","style","transform","_hash","map","i","getAttribute","findHash","location","hash","findIndex","includes","goto","wrapGoto","_goto","window","addEventListener","e","hashIndex","transition","dispatchEvent","CustomEvent","arguments","history","replaceState","handleKeyDown","keyCode","handleMouseWheel","Math","max","min","wheelDelta","detail","handleTouchStart","touches","_touchStartY","pageY","handleTouchMove","preventDefault","deltaY","abs","removeEventListener"],"mappings":"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"}